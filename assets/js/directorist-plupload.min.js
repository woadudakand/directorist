!function(){"use strict";function a(a,e){a=".directorist-dom-data-"+a,e||(e=document);var t=e.querySelector(a);if(!t||!t.dataset.value)return{};var l=directorist&&directorist.script_debugging&&"1"==directorist.script_debugging;try{var i=atob(t.dataset.value);return JSON.parse(i)}catch(a){return l&&console.log(t,a),{}}}jQuery.fn.exists=function(){return jQuery(this).length>0};var e=a("atbdp_plupload_params"),t=a("atbdp_params"),l=jQuery;function i(){var i,r,d;e=a("atbdp_plupload_params"),t=a("atbdp_params"),l(".plupload-upload-uic").exists()&&(d=jQuery("#atbdpectory-add-post input[name='ID']").length?jQuery("#atbdpectory-add-post input[name='ID']").val():jQuery("#post input[name='post_ID']").val(),l(".plupload-upload-uic").each((function(a,p){var s=l(this),n=s.attr("id").replace("plupload-upload-ui",""),u=jQuery("#"+n+"upload-error");o(n),(i=JSON.parse(e.base_plupload_config)).browse_button=n+i.browse_button,i.container=n+i.container,jQuery("#"+n+"dropbox").length&&(i.drop_element=n+"dropbox"),i.file_data_name=n+i.file_data_name,i.multipart_params.imgid=n,i.multipart_params.post_id=d,i.max_file_size=l("#"+n+"_file_size").val(),s.hasClass("plupload-upload-uic-multiple")&&(i.multi_selection=!0);var f=jQuery("#"+n+"_allowed_types").val();if(f=f&&""!=f?f:"","post_images"==n&&void 0!==t.atbdp_allowed_img_types&&""!=t.atbdp_allowed_img_types&&(f=t.atbdp_allowed_img_types),f&&""!=f){var c=void 0!==t.txt_all_files&&""!=t.txt_all_files?t.txt_all_files:"Allowed files";i.filters=[{title:c,extensions:f}]}var v=new plupload.Uploader(i);v.bind("Init",(function(a,e){if(v.features.dragdrop){var t=jQuery("#"+n+"dropbox");t.on("dragenter",(function(a){t.addClass("dragover")})),t.on("dragleave",(function(a){t.removeClass("dragover")})),t.on("drop",(function(){t.removeClass("dragover")}))}})),v.init(),v.bind("Error",(function(a,e){var i;if(u.addClass("upload-error"),-600==e.code)i=(i=void 0!==t.err_max_file_size&&""!=t.err_max_file_size?t.err_max_file_size:"File size error : You tried to upload a file over %s").replace("%s",l("#"+n+"_file_size").val());else if(-601==e.code)if(i=void 0!==t.err_file_type&&""!=t.err_file_type?t.err_file_type:"File type error. Allowed file types: %s","post_images"==n){var r=""!=f?"."+f.replace(/,/g,", ."):"*";i=i.replace("%s",r)}else i=i.replace("%s",jQuery("#"+n+"_allowed_types").attr("data-exts"));else i=e.message;u.html(i)})),v.bind("FilesAdded",(function(a,e){var i=parseInt(jQuery("#"+n+"totImg").val()),o=parseInt(jQuery("#"+n+"image_limit").val());if(u.html("").removeClass("upload-error"),o&&s.hasClass("plupload-upload-uic-multiple")&&o>0){if(i>=o&&o>0){for(;a.files.length>0;)a.removeFile(a.files[0]);return r=(r=void 0!==t.err_file_upload_limit&&""!=t.err_file_upload_limit?t.err_file_upload_limit:"You have reached your upload limit of %s files.").replace("%s",o),u.addClass("upload-error").html(r),!1}if(a.files.length>o&&o>0){for(;a.files.length>0;)a.removeFile(a.files[0]);return r=(r=void 0!==t.err_pkg_upload_limit&&""!=t.err_pkg_upload_limit?t.err_pkg_upload_limit:"You may only upload %s files with this package, please try again.").replace("%s",o),u.addClass("upload-error").html(r),!1}}l.each(e,(function(a,e){s.find(".filelist").append('<div class="file" id="'+e.id+'"><b>'+e.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(e.size)+') <div class="fileprogress"></div></div>')})),a.refresh(),a.start()})),v.bind("UploadProgress",(function(a,e){l("#"+e.id+" .fileprogress").width(e.percent+"%"),l("#"+e.id+" span").html(plupload.formatSize(parseInt(e.size*e.percent/100)))}));var m=0,_=new Array;v.bind("FileUploaded",(function(a,e,t){if((t=JSON.parse(t.response)).success){var i=parseInt(jQuery("#"+n+"totImg").val());if(_[m]=a,m++,l("#"+e.id).fadeOut(),s.hasClass("plupload-upload-uic-multiple")){i++,jQuery("#"+n+"totImg").val(i);var r=l.trim(l("#"+n,l("#"+n+"plupload-upload-ui").parent()).val());r=r?r+"::"+t.data:t.data,l("#"+n,l("#"+n+"plupload-upload-ui").parent()).val(r)}else l("#"+n,l("#"+n+"plupload-upload-ui").parent()).val(t.data+"");o(n)}else u.addClass("upload-error").html(t.data)})),Error})))}function r(a){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(a).replace(/[&<>"'`=\/]/g,(function(a){return e[a]}))}function o(a){var e=parseInt(jQuery("#"+a+"totImg").val()),l=(parseInt(jQuery("#"+a+"image_limit").val()),jQuery),i=l("#"+a+"plupload-thumbs");i.html("");var d=l("#"+a,l("#"+a+"plupload-upload-ui").parent()).val();if(void 0!==t.action_remove&&""!=t.action_remove&&t.action_remove,d){for(var p=d.split("::"),s=0;s<p.length;s++)if(p[s]&&"null"!=p[s]){var n=p[s].split("|"),u=n[0],f=n[1],c=n[2],v=n[3],m="",_="";void 0===f&&(f=""),void 0===c&&(c=""),void 0===v&&(v=""),c=r(c),v=r(v);var g=u.substring(u.lastIndexOf(".")+1);(g=g.split("?").shift())&&(g=g.toLowerCase());var h=u.lastIndexOf("/")+1,b=u.lastIndexOf(".");if(b<h)continue;var y=u.substr(h,b<h?loc.length:b),j="",x="";if("jpg"==g||"jpe"==g||"jpeg"==g||"png"==g||"gif"==g||"bmp"==g||"ico"==g)j='<img class="atbdp-file-info" data-id="'+f+'" data-title="'+c+'" data-caption="'+v+'" data-src="'+u+'" src="'+u+'" alt=""  />',c.trim()&&(m='<span class="atbdp-title-preview">'+c+"</span>"),v.trim()&&(_='<span class="atbdp-caption-preview">'+v+"</span>");else{var Q="la-file";"pdf"==g?Q="la-file-pdf-o":"zip"==g||"tar"==g?Q="la-file-zip-o":"doc"==g||"odt"==g?Q="la-file-word-0":"txt"==g||"text"==g?Q="la-file-text-0":"csv"==g||"ods"==g||"ots"==g?Q="la-file-excel-0":"avi"!=g&&"mp4"!=g&&"mov"!=g||(Q="la-file-video-0"),x="file-thumb",j='<i title="'+y+'" class="la '+Q+' atbdp-file-info" data-id="'+f+'" data-title="'+c+'" data-caption="'+v+'" data-src="'+u+'" aria-hidden="true"></i>'}var w=directorist.assets_url+"icons/font-awesome/svgs/solid/trash-alt.svg",I=directorist.icon_markup.replace("##URL##",w).replace("##CLASS##",""),C=l('<div class="thumb '+x+'" id="thumb'+a+s+'">'+m+j+_+'<div class="atbdp-thumb-actions"><span class="thumbremovelink" id="thumbremovelink'+a+s+'">'+I+"</span></div></div>");i.append(C),C.find(".thumbremovelink").click((function(){jQuery("#"+a+"plupload-upload-ui").hasClass("plupload-upload-uic-multiple")&&(e--,jQuery("#"+a+"totImg").val(e)),jQuery("#"+a+"upload-error").html(""),jQuery("#"+a+"upload-error").removeClass("upload-error");var t=l(this).attr("id").replace("thumbremovelink"+a,"");t=parseInt(t);var i=[];d=l("#"+a,l("#"+a+"plupload-upload-ui").parent()).val(),p=d.split("::");for(var r=0;r<p.length;r++)r!=t&&(i[i.length]=p[r]);return l("#"+a,l("#"+a+"plupload-upload-ui").parent()).val(i.join("::")),o(a),!1}))}p.length>1&&(i.sortable({update:function(e,t){var r=[];i.find(".atbdp-file-info").each((function(){r[r.length]=l(this).data("src")+"|"+l(this).data("id")+"|"+l(this).data("title")+"|"+l(this).data("caption"),l("#"+a,l("#"+a+"plupload-upload-ui").parent()).val(r.join("::")),o(a)}))}}),i.disableSelection());var z=[];i.find(".atbdp-file-info").each((function(){z[z.length]=l(this).data("src")+"|"+l(this).data("id")+"|"+l(this).data("title")+"|"+l(this).data("caption"),l("#"+a,l("#"+a+"plupload-upload-ui").parent()).val(z.join("::"))}))}}e&&(jQuery(document).ready(i),window.addEventListener("directorist-reload-plupload",i))}();